<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <link rel="stylesheet" type="text/css" href="/xcr/css/build.css">
    <link rel="stylesheet" href="/xcr/plugins/jedate/skin/icon.css"/>
    <link rel="stylesheet" type="text/css" href="/xcr/plugins/window/window.css">
    <script type="text/javascript" src="/xcr/plugins/jedate/jedate.js"></script>
    <script type="text/javascript" src="/xcr/plugins/window/window.js"></script>
    <script type="text/javascript" src="/xcr/js/toc/ToC_Common2.js"></script>
    <style type="text/css">
        .selectDateOnly {
            width: 170px;
            float: left;
            border: 1px solid #d2d6de;
            padding-left: 10px;
            height: 30px;
            border-radius: 5px;
        }

        .jedatebox {
            z-index: 99999999 !important;
        }
    </style>
</head>
<body class="gray-bg" style="overflow:auto ! important;">
<div class="container" style="width: 100%;background-color: whitesmoke">
    <div style="margin-top: 10px;width: 100%;">
        <div style="width: 100%;height: 10px;"></div>
        <div style="width: 100%;height: 50px;margin-top: 10px;">
            <h5>
                &nbsp;&nbsp;<i class="fa fa-chevron-right"></i>&nbsp;&nbsp;注册抽奖活动
                &nbsp;&nbsp;<i class="fa fa-chevron-right"></i>&nbsp;&nbsp;<a
                    href="javascript:loadHtml('/xcr/toc/registLottoActivityList.htm')">活动列表</a>
                &nbsp;&nbsp;<i class="fa fa-chevron-right"></i>&nbsp;&nbsp;<a href="#">添加活动</a></h5>
        </div>
        <div class="tab-content" style="margin-top: 5px;width: 99%;margin: 0 auto">
            <div id="detailTable" style="background-color: white;">
                <div style="width: 100%;margin: 0 auto;">
                    <div style="width: 80%;margin-left: 1%">

                        <!------------------- 基本信息 ------------------->
                        <div style="height: 20px;margin-top: 5px;">
                        </div>
                        <h4><i class="fa fa-edit" style="color: #00a0e9"></i> 抽奖活动基础配置
                            <button id="saveActivity" type="button" class="btn btn-vk btn-sm rightSize"
                                    style="width: 10%;margin-top: -5px;margin-left: 70%"
                                    onclick="saveRedpacketActivity();">
                                <i class="fa fa-plus"></i> 保存
                        </h4>
                        <hr/>
                        <table style="width: 100%;height:150px;" cellspacing="0" cellpadding="0">
                            <tbody style="margin-top: 30px;">
                            <tr>
                                <td style="width: 5%;text-align: right;color:black">
                                    活 动 名 称:<span style="color:#f00;">*</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                </td>
                                <td style="width: 35%;">
                                    <input id="lottoActivityName" name="lottoActivityName" value=""
                                           style="height: 30px;width: 25%"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 5%;text-align: right;color:black">
                                    活 动 时 段:<span style="color:#f00;">*</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                </td>
                                <td style="width: 35%;">
                                    <input class="datainp selectDateOnly wicon" id="activityStartDay" type="text"
                                           placeholder="请选择" readonly>
                                    <label style="float: left;margin: 5px;"> 至 </label>
                                    <input class="datainp selectDateOnly wicon" id="activityEndDay" type="text"
                                           placeholder="请选择" readonly>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <!--------------------- 红包分期管理 ---------------------->
                        <div style="height: 20px;margin-top: 5px;">
                        </div>
                        <h4><i class="fa fa-edit" style="color: #00a0e9"></i> 抽奖分期管理&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btn_add" type="button" class="btn btn-vk btn-sm rightSize"
                                    style="width: 10%;margin-top: -5px;"
                                    onclick="addLottoActivity();">
                                <i class="fa fa-plus"></i> 添加
                        </h4>
                        <hr/>
                        <div id="redpacketByStagesList">

                        </div>
                        <div style="height: 30px;margin-top: 5px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 添加活动期数 -->
            <div class="modal fade" id="addRedpacketByStages" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel"
                 style="width: 100%;">
                <div class="modal-dialog" role="document" style="width: 60%;">
                    <div class="modal-content">
                        <div class="modal-body" style="height: auto">
                            <div style="width: 100%"><h4 style="text-align: center">添加活动期数</h4></div>
                            <hr/>
                            <table style="width: 100%;height:auto;margin-top: 20px;"
                                   cellspacing="0" cellpadding="0">
                                <tbody style="margin-top: 30px;" id="activityAwardList">
                                <tr style="height: 80px;">
                                    <td style="width: 10%;text-align: right;color:black">
                                        活 动 第 :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    </td>
                                    <td style="width: 35%;">
                                        <input id="dayNum" style="width: 20%;height: 30px; text-align: center"
                                               type="number"
                                               value="1"/>
                                        期，第 <input id="timeNum" style="width: 20%;height: 30px; text-align: center"
                                                   type="number"
                                                   value="1"/> 波
                                    </td>
                                </tr>
                                <tr style="height: 80px;">
                                    <td style="width: 10%;text-align: right;color:black">
                                        起止时间:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    </td>
                                    <td style="width: 35%;">
                                        <input class="datainp selectDateOnly wicon dayTimeNum" id="startDay_1"
                                               type="text"
                                               placeholder="请选择" readonly>
                                        <label style="float: left;margin: 5px;"> 至 </label>
                                        <input class="datainp selectDateOnly wicon dayTimeNum" id="endDay_1" type="text"
                                               placeholder="请选择" readonly>
                                    </td>
                                </tr>
                                <tr style="height: 100px;">
                                    <td style="width: 10%;text-align: right;color:black">
                                        本期奖品:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    </td>
                                    <td style="width: 90%;">
                                        <table style="margin-top: 10px;">
                                            <tbody>
                                            <tr>
                                                <br/>
                                                <td style="width: 33%">
                                                    <i class="fa fa-circle" style="color: #00a0e9"></i>奖项:&nbsp;<input
                                                        id="awardNum" name="awardNum" type="number"
                                                        style="height: 30px;"/>&nbsp;份。
                                                </td>
                                                <td style="width: 20%">
                                                    <div class="addAward"><i class="fa fa-plus"
                                                                             style="color: green"></i></div>
                                                </td>
                                                <td style="width: 60%"></td>
                                            </tr>
                                            <tr>
                                                <td colspan="3">
                                                    <table style="margin-top: 10px;">
                                                        <tbody id="activityAwardDetailList">
                                                        <tr id="activityAwardDetailAdd">
                                                            <td>
                                                                <select class="form-control awardtype awardtype_one"
                                                                        id="awardtype"
                                                                        name="awardtype" style="width:100%;">
                                                                    <option value="雅堂电商" selected="selected">雅堂电商
                                                                    </option>
                                                                    <option value="雅堂小超">雅堂小超</option>
                                                                </select>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;商品&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productName"
                                                                                                 name="productName"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;链接&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productUrl"
                                                                                                 name="productUrl"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="productNum"
                                                                                                 name="productNum"/>&nbsp;件
                                                            </td>

                                                            <!--**********************小超***********************-->
                                                            <td class="shop" style="display: none">
                                                                <div style="display:inline-block">
                                                                    &nbsp;&nbsp;&nbsp;优惠券&nbsp;
                                                                </div>
                                                                <div style="display:inline-block">
                                                                    <select class="form-control discountType"
                                                                            id="discountType" name="discountType">
                                                                        <option value="0" selected="selected">-请选择-
                                                                        </option>
                                                                        #foreach($pushCouponDTO in $pushCouponDTOList)
                                                                            <option value="$pushCouponDTO.couponId">$pushCouponDTO.couponName</option>
                                                                        #end
                                                                    </select>
                                                                </div>
                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="discountNum"
                                                                                                 name="discountNum"/>&nbsp;张
                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                <div style="width: 280px;"></div>
                                                            </td>
                                                            <!--*********************************************-->

                                                            <td>
                                                                <div class=""
                                                                     style="margin-left: 10px;">
                                                                ##                                                                    <i class="fa fa-plus" style="color: green"></i>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>

                                <tr style="height: 100px;display: none" id="activityAwardAdd">
                                    <td style="width: 10%;text-align: right;color:black">
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    </td>
                                    <td style="width: 90%;">
                                        <table style="margin-top: 10px;">
                                            <tbody>
                                            <tr>
                                                <td style="width: 33%">
                                                    <i class="fa fa-circle" style="color: #00a0e9"></i>奖项:&nbsp;<input
                                                        type="number" style="height: 30px;" name="awardNum"/>&nbsp;份。
                                                </td>
                                                <td style="width: 20%">
                                                    <div class="removeAward"><i class="fa fa-remove"
                                                                                style="color: red"></i></div>
                                                </td>
                                                <td style="width: 60%"></td>
                                            </tr>
                                            <tr>
                                                <td colspan="3">
                                                    <table style="margin-top: 10px;">
                                                        <tbody>
                                                        <tr>
                                                            <td>
                                                                <select class="form-control awardtype" id="awardtype"
                                                                        style="width:100%;" name="awardtype">
                                                                    <option value="雅堂电商" selected="selected">雅堂电商
                                                                    </option>
                                                                    <option value="雅堂小超">雅堂小超</option>
                                                                </select>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;商品&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productName"
                                                                                                 name="productName"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;链接&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productUrl"
                                                                                                 name="productUrl"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="productNum"
                                                                                                 name="productNum"/>&nbsp;件
                                                            </td>

                                                            <!--**********************小超***********************-->
                                                            <td class="shop" style="display: none">
                                                                <div style="display:inline-block">
                                                                    &nbsp;&nbsp;&nbsp;优惠券&nbsp;
                                                                </div>
                                                                <div style="display:inline-block">
                                                                    <select class="form-control discountType"
                                                                            id="discountType" name="discountType">
                                                                        <option value="0" selected="selected">-请选择-
                                                                        </option>
                                                                        #foreach($pushCouponDTO in $pushCouponDTOList)
                                                                            <option value="$pushCouponDTO.couponId">$pushCouponDTO.couponName</option>
                                                                        #end
                                                                    </select>
                                                                </div>
                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="discountNum"
                                                                                                 name="discountNum"/>&nbsp;张
                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                <div style="width: 280px;"></div>
                                                            </td>
                                                            <!--*********************************************-->

                                                            <td>
                                                                <div class=""
                                                                     style="margin-left: 10px;">
                                                                ##                                                                    <i class="fa fa-plus" style="color: green"></i>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        <tr style="display: none" id="activityAwardDetailAdd_down">
                                                            <td>
                                                                <select class="form-control awardtype" id="awardtype"
                                                                        style="width:100%;" name="awardtype">
                                                                    <option value="雅堂电商" selected="selected">雅堂电商
                                                                    </option>
                                                                    <option value="雅堂小超">雅堂小超</option>
                                                                </select>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;商品&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productName"
                                                                                                 name="productName"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;链接&nbsp;<input type="text"
                                                                                                 style="height: 30px;"
                                                                                                 class="productUrl"
                                                                                                 name="productUrl"/>
                                                            </td>
                                                            <td class="business">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="productNum"
                                                                                                 name="productNum"/>&nbsp;件
                                                            </td>

                                                            <!--**********************小超***********************-->
                                                            <td class="shop" style="display: none">
                                                                <div style="display:inline-block">
                                                                    &nbsp;&nbsp;&nbsp;优惠券&nbsp;
                                                                </div>
                                                                <div style="display:inline-block">
                                                                    <select class="form-control discountType"
                                                                            id="discountType" name="discountType">
                                                                        <option value="0" selected="selected">-请选择-
                                                                        </option>
                                                                        #foreach($pushCouponDTO in $pushCouponDTOList)
                                                                            <option value="$pushCouponDTO.couponId">$pushCouponDTO.couponName</option>
                                                                        #end
                                                                    </select>
                                                                </div>

                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                &nbsp;&nbsp;&nbsp;数量&nbsp;<input type="number"
                                                                                                 style="height: 30px;"
                                                                                                 class="discountNum"
                                                                                                 name="discountNum"/>&nbsp;张
                                                            </td>
                                                            <td class="shop" style="display: none">
                                                                <div style="width: 280px;"></div>
                                                            </td>
                                                            <!--*********************************************-->

                                                            <td>
                                                                <div class="removeAwardDetail"
                                                                     style="margin-left: 10px;">
                                                                    <i class="fa fa-remove" style="color: red"></i>
                                                                </div>
                                                            </td>
                                                        </tr>

                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer" style="height: 100px">
                            <table style="width: 100%;height:100px;margin: 0 auto;" cellspacing="0" cellpadding="0">
                                <tbody>
                                <tr>
                                    <td style="width:15%;"></td>
                                    <td style="width: 15%;text-align: left;">
                                        <button id="btn_add" type="button" class="btn btn-vk btn-sm rightSize"
                                                style="width: 70%;float: left;margin-top: 5px;"
                                                onclick="saveRedpacketByStages();">
                                            <i class="fa fa-save"></i> 确认
                                        </button>
                                    </td>
                                    <td style="width: 15%;text-align: left;">
                                        <button id="btn_add" type="button" class="btn btn-vk btn-sm rightSize"
                                                style="width: 70%;float: left;margin-top: 5px;"
                                                data-dismiss="modal">
                                            <i class="fa fa-repeat"></i> 取消
                                        </button>
                                    </td>
                                    <td style="width: 15%"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="success" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">操作成功！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="fail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">服务器异常！保存失败，请稍后重试！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="activityNameNotNull" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">活动名称不能为空！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="timeNotNull" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">活动时间不能为空！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="createTimeError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">开始时间要大于当前时间！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="timeError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">开始时间要小于结束时间！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dayNumNotNull" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">活动(期/波)不能为空！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dayTimeError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">分期时间要在活动时间之间！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="lottoActivityNameTooLong" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">活动名称过长！不能大于20字！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="awardListDetailError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">奖品信息不完整，请检查！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dayNumAndTimeNumError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">分期保存错误，不能出现相同期数！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="timeOverError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">分期活动时间有交叉或期数重复，请检查！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="activityTimeOverError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">消息</h4>
            </div>
            <div class="modal-body">
                <div style="width: 100%"><h5 style="text-align: center">活动时间有重叠，请修改活动时间！</h5></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    jeDate({
        dateCell: "#activityStartDay",
        format: "YYYY-MM-DD hh:mm:ss",
        festival: true, //是否显示节日
        isinitVal: false,
        isTime: true, //isClear:false,
        minDate: "2010-01-01 00:00:00",
        okfun: function (val) {
        }
    })
    jeDate({
        dateCell: "#activityEndDay",
        format: "YYYY-MM-DD hh:mm:ss",
        festival: true, //是否显示节日
        isinitVal: false,
        isTime: true, //isClear:false,
        minDate: "2010-01-01 00:00:00",
        okfun: function (val) {
        }
    })
    jeDate({
        dateCell: "#startDay_1",
        format: "YYYY-MM-DD hh:mm:ss",
        festival: true, //是否显示节日
        isinitVal: false,
        isTime: true, //isClear:false,
        minDate: "2010-01-01 00:00:00",
        okfun: function (val) {
        }
    })
    jeDate({
        dateCell: "#endDay_1",
        format: "YYYY-MM-DD hh:mm:ss",
        festival: true, //是否显示节日
        isinitVal: false,
        isTime: true, //isClear:false,
        minDate: "2010-01-01 00:00:00",
        okfun: function (val) {
        }
    })

    function Appendzero(obj) {
        if (obj < 10) return "0" + "" + obj;
        else return obj;
    }

    //活动分期
    function addLottoActivity() {
        var lottoActivityName = $("#lottoActivityName").val(); //活动名称
        var activityStartDay = $("#activityStartDay").val();   //活动开始时间
        var activityEndDay = $("#activityEndDay").val();       //活动结束时间

        console.log("activityStartDay:" + activityStartDay + "  activityEndDay:" + activityEndDay)
        var lottoActivityAwardList = [];                       //分期列表
        //基本信息校验
        if (lottoActivityName == null || lottoActivityName == "") {
            $("#activityNameNotNull").modal("toggle");
            return false;
        }
        if (lottoActivityName.length > 20) {
            $("#lottoActivityNameTooLong").modal("toggle");
            return false;
        }
        if (activityStartDay == null || activityStartDay == "" || activityEndDay == null || activityEndDay == "") {
            $("#timeNotNull").modal("toggle");
            return false;
        }

        var now = new Date().getTime();
        var start = new Date(activityStartDay).getTime();
        var end = new Date(activityEndDay).getTime();
        if (start < now) {
            $("#createTimeError").modal("toggle");
            return false;
        }
        console.log("start > end:" + (start > end))
        console.log("start:" + start + "  end:" + end)
        if (start > end) {
            $("#timeError").modal("toggle");
            return false;
        }

        $('#addRedpacketByStages').modal('toggle');
    }

    $(".addAward").click(function () {
        var html = '';
        html += '<tr style="height: 100px;">';
        html += $("#activityAwardAdd").html();
        html += '</tr>';
        var a = $("#activityAwardList").append(html);
        a.find('.removeAward').on('click', function () {
            $(this).parent().parent().parent().parent().parent().parent().remove();
        });

        a.find(".addAwardDetail").click(function () {
            var html = '';
            html += '<tr>';
            html += $("#activityAwardDetailAdd_down").html();
            html += '</tr>';
            var a = $(this).parent().parent().parent().append(html);
            a.find('.removeAwardDetail').on('click', function () {
                $(this).parent().parent().remove();
            });

        });
        a.find(".awardtype").change(function () {
            var typevalue = this.value;
            console.log("typevalue:" + typevalue);

            var awardTypeList = "";
            awardTypeList = this.parentNode.parentNode.parentNode.children;
            for (var k = 0; k < awardTypeList.length; k++) {
                console.log("awardTypeList[k]:" + awardTypeList[k].innerHTML);
                var businessList = awardTypeList[k].getElementsByClassName('business');
                var shopList = awardTypeList[k].getElementsByClassName('shop');
                if (typevalue == "雅堂电商") {
                    $(this).parent().parent().find(".business").css("display", "table-cell");
                    $(this).parent().parent().find(".shop").css("display", "none");
                }
                if (typevalue == "雅堂小超") {
                    $(this).parent().parent().find(".business").css("display", "none");
                    $(this).parent().parent().find(".shop").css("display", "table-cell");
                }
            }
        });
    });

    $(".addAwardDetail_top").click(function () {
        var html = '';
        html += '<tr>';
        html += $("#activityAwardDetailAdd_down").html();
        html += '</tr>';
        var a = $(this).parent().parent().parent().append(html);
        a.find('.removeAwardDetail').on('click', function () {
            $(this).parent().parent().remove();
        });
    });

    $(".awardtype_one").change(function () {
        var typevalue = this.value;
        console.log("typevalue:" + typevalue);

        var awardTypeList = "";
        awardTypeList = this.parentNode.parentNode.parentNode.children;
        for (var k = 0; k < awardTypeList.length; k++) {
            console.log("awardTypeList[k]:" + awardTypeList[k].innerHTML);
            var businessList = awardTypeList[k].getElementsByClassName('business');
            var shopList = awardTypeList[k].getElementsByClassName('shop');
            if (typevalue == "雅堂电商") {
                $(this).parent().parent().find(".business").css("display", "table-cell");
                $(this).parent().parent().find(".shop").css("display", "none");
            }
            if (typevalue == "雅堂小超") {
                $(this).parent().parent().find(".business").css("display", "none");
                $(this).parent().parent().find(".shop").css("display", "table-cell");
            }
        }
    });

    //保存分期
    function saveRedpacketByStages() {

        var activityStartDay = $("#activityStartDay").val();   //活动开始时间
        var activityEndDay = $("#activityEndDay").val();       //活动结束时间
        var dayNum = $("#dayNum").val();
        var timeNum = $("#timeNum").val();
        var startDay_1 = $("#startDay_1").val();
        var endDay_1 = $("#endDay_1").val();

        //校验 TODO
        if (dayNum == null || dayNum == "" || timeNum == null || timeNum == "") {
            $("#dayNumNotNull").modal("toggle");
            return false;
        }
        if (timeNum == null || timeNum == "" || timeNum == null || timeNum == "") {
            $("#dayNumNotNull").modal("toggle");
            return false;
        }
        if (startDay_1 == null || startDay_1 == "" || endDay_1 == null || endDay_1 == "") {
            $("#timeNotNull").modal("toggle");
            return false;
        }
        var startDay_1Date = new Date(startDay_1);
        var endDay_1Date = new Date(endDay_1);
        var activityStartDayDate = new Date(activityStartDay);
        var activityEndDayDate = new Date(activityEndDay);
        if (startDay_1Date.getTime() < activityStartDayDate.getTime()) {
            $("#dayTimeError").modal("toggle");
            return false;
        }
        if (endDay_1Date.getTime() > activityEndDayDate.getTime()) {
            $("#dayTimeError").modal("toggle");
            return false;
        }
        if (startDay_1Date.getTime() > endDay_1Date.getTime()) {
            $("#timeError").modal("toggle");
            return false;
        }


        //1:获取奖品元素集合
        var awardNum = document.getElementsByName('awardNum');
        var awardListDetail = "";

        console.log("awardNum.length:" + awardNum.length)

        for (var i = 0; i < awardNum.length; i++) {
            if (awardNum[i].value != null && awardNum[i].value != "") {
                awardListDetail += '<div style="display:inline-block;margin-left: 10px;margin-top: 5px;background-color: lightgray;border-radius:5px;" id="awardDetailList">' +
                        '<p><h5>&nbsp;&nbsp;奖品 <span style="color: red">' + awardNum[i].value + '</span>份&nbsp;&nbsp;</h5></p>' +
                        '<input type="text" name="awardNum_param" class="awardNum_param" style="display:none" value="' + awardNum[i].value + '"/>';
                var awardDetailList = "";
                awardDetailList = awardNum[i].parentNode.parentNode.parentNode.children;

                var awardtype = awardDetailList[1].getElementsByClassName('awardtype');
                var productName = awardDetailList[1].getElementsByClassName('productName');
                var productUrl = awardDetailList[1].getElementsByClassName('productUrl');
                var productNum = awardDetailList[1].getElementsByClassName('productNum');
                var discountType = awardDetailList[1].getElementsByClassName('discountType');
                var discountNum = awardDetailList[1].getElementsByClassName('discountNum');
                var awardListDetail_1 = "";
                for (var j = 0; j < awardtype.length; j++) {

                    console.log("awardtype[" + i + "-" + j + "].value:" + awardtype[j].value)

                    if (awardtype[j].value != null && awardtype[j].value != "") {
                        if (awardtype[j].value == "雅堂电商") {
                            if (productName[j].value != null && productName[j].value != "" && productNum[j].value != null && productNum[j].value != "" && productUrl[j].value != null && productUrl[j].value != "") {
                                awardListDetail_1 += '<p><h5>&nbsp;&nbsp;' + awardtype[j].value + '<span style="color: red">' + productName[j].value + ' ' + productNum[j].value + '</span>件&nbsp;&nbsp;</h5></p>' +
                                        '<input type="text" name="awardtype_param" class="awardtype_param" style="display:none" value="' + awardtype[j].value + '"/>' +
                                        '<input type="text" name="productName_param" class="productName_param" style="display:none" value="' + productName[j].value + '"/>' +
                                        '<input type="text" name="productUrl_param" class="productUrl_param" style="display:none" value="' + productUrl[j].value + '"/>' +
                                        '<input type="text" name="productNum_param" class="productNum_param" style="display:none" value="' + productNum[j].value + '"/>' +
                                        '<input type="text" name="discountType_param" class="discountType_param" style="display:none" value=""/>' +
                                        '<input type="text" name="discountNum_param" class="discountNum_param" style="display:none" value=""/>';
                            }
                        } else {
                            if (discountType[j].value != null && discountType[j].value != "" && discountNum[j].value != null && discountNum[j].value != "") {
                                awardListDetail_1 += '<p><h5>&nbsp;&nbsp;' + awardtype[j].value + '<span style="color: red">' + discountType[j].value + ' ' + discountNum[j].value + '</span>张&nbsp;&nbsp;</h5></p>' +
                                        '<input type="text" name="awardtype_param" class="awardtype_param" style="display:none" value="' + awardtype[j].value + '"/>' +
                                        '<input type="text" name="discountType_param" class="discountType_param" style="display:none" value="' + discountType[j].value + '"/>' +
                                        '<input type="text" name="discountNum_param" class="discountNum_param" style="display:none" value="' + discountNum[j].value + '"/>' +
                                        '<input type="text" name="productName_param" class="productName_param" style="display:none" value=""/>' +
                                        '<input type="text" name="productUrl_param" class="productUrl_param" style="display:none" value=""/>' +
                                        '<input type="text" name="productNum_param" class="productNum_param" style="display:none" value=""/>';
                            }
                        }
                    }
                }
                if (awardListDetail_1 == "") {
                    $("#awardListDetailError").modal("toggle");
                    return false;
                }

                awardListDetail += awardListDetail_1 + '</div>';
            }
        }

        if (awardListDetail == "") {
            $("#awardListDetailError").modal("toggle");
            return false;
        }

        //添加页面数据
        html = '<div>' +
                '<table style="width: 100%;height:160px;background-color: gainsboro;margin-top: 20px;border-radius:10px;"cellspacing="0" cellpadding="0">' +
                '<tbody style="margin-top: 30px;">' +
                '<tr>' +
                '<td style="width: 5%;text-align: right;color:black">' +
                '活 动 第 :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '</td>' +
                '<td style="width: 35%;">' +
                dayNum + ' 期，第 ' + timeNum + ' 波' +
                '</td>' +
                '<td rowspan="5" style="width: 0.1%;background: lightgray">' +
                '<hr style="width: 1px;">' +
                '</td>' +
                '<td style="text-align: center;width: 8%" rowspan="2">' +
                '<h4 style="text-align: center">未开始</h4>' +
                '</td> </tr> <tr>' +
                '<td style="width: 5%;text-align: right;color:black">' +
                '起止时间:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '</td>' +
                '<td style="width: 35%;">' +
                startDay_1 + ' 至 ' + endDay_1 +
                '</td>' +
                '</tr>' +
                '<tr>' +
                '<td style="width: 5%;text-align: right;color:black">' +
                '本期奖品:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '</td> <td> <table> <tbody> <tr> <td id="awardList">' +
                awardListDetail +
                '</td> </tr> </tbody> </table> </td>' +
                '<td style="text-align: center;width: 8%">' +
                '<button id="btn_add" type="button" class="btn btn-vk btn-sm remove" style="width: 70%;">' +
                '<i class="fa fa-reply-all"></i> 删除' +
                '</button></td> </tr> </tbody> </table>' +
                '<input type="text" name="dayNum_param" style="display:none" value="' + dayNum + '"/>' +
                '<input type="text" name="timeNum_param" style="display:none" value="' + timeNum + '"/>' +
                '<input type="text" name="startDay_1_param" style="display:none" value="' + startDay_1 + '"/>' +
                '<input type="text" name="endDay_1_param" style="display:none" value="' + endDay_1 + '"/></div>';

        var a = $("#redpacketByStagesList").append(html);

        $("#addRedpacketByStages").modal("hide"); //关闭模态框

        //删除分期
        a.find(".remove").on('click', function () {
            var activeThis = $(this);
            win.confirm('删除确认', '确认删除该分期？', function (r) {
                console.log("r：" + r);
                if (r == true) {
                    activeThis.parent().parent().parent().parent().parent().remove();
                }
            });
        });
    }

    //保存活动
    function saveRedpacketActivity() {
        $("#saveActivity").attr("disabled", true);
        var lottoActivityName = $("#lottoActivityName").val(); //活动名称
        var activityStartDay = $("#activityStartDay").val();   //活动开始时间
        var activityEndDay = $("#activityEndDay").val();       //活动结束时间
        var lottoActivityAwardList = [];                       //分期列表

        //基本信息校验
        if (lottoActivityName == null || lottoActivityName == "") {
            $("#saveActivity").attr("disabled", false);
            $("#activityNameNotNull").modal("toggle");
            return false;
        }
        if (activityStartDay == null || activityStartDay == "" || activityEndDay == null || activityEndDay == "") {
            $("#saveActivity").attr("disabled", false);
            $("#timeNotNull").modal("toggle");
            return false;
        }
        var now = new Date();
        var activityStartDayDate = new Date(activityStartDay);
        var activityEndDayDate = new Date(activityEndDay);

        if (activityStartDayDate.getTime() < now.getTime()) {
            $("#saveActivity").attr("disabled", false);
            $("#createTimeError").modal("toggle");
            return false;
        }
        if (activityStartDayDate.getTime() > activityEndDayDate.getTime()) {
            $("#saveActivity").attr("disabled", false);
            $("#timeError").modal("toggle");
            return false;
        }

        var dayNum_param = document.getElementsByName('dayNum_param');    //期
        var timeNum_param = document.getElementsByName('timeNum_param');  //波
        var startDay_1_param = document.getElementsByName('startDay_1_param'); //开始时间
        var endDay_1_param = document.getElementsByName('endDay_1_param');     //结束时间

        if (dayNum_param == null || dayNum_param == "" || timeNum_param == null || timeNum_param == "") {
            $("#saveActivity").attr("disabled", false);
            $("#awardListDetailError").modal("toggle");
            return false;
        }
        if (dayNum_param.length == 0 || timeNum_param.length == 0) {
            $("#saveActivity").attr("disabled", false);
            $("#awardListDetailError").modal("toggle");
            return false;
        }

        var dayNum_param_temp = dayNum_param[0].value + "-" + timeNum_param[0].value;
        for (var k = 0; k < dayNum_param.length; k++) {
            console.log("dayNum_param[" + k + "]:" + dayNum_param[k].value);
            console.log("timeNum_param[" + k + "]:" + timeNum_param[k].value);
            console.log("startDay_1_param[" + k + "]:" + startDay_1_param[k].value);
            console.log("endDay_1_param[" + k + "]:" + endDay_1_param[k].value);

            if (k > 0) {
                if (dayNum_param_temp == dayNum_param[k].value + "-" + timeNum_param[k].value) {
                    $("#saveActivity").attr("disabled", false);
                    $("#dayNumAndTimeNumError").modal("toggle"); //相同期数
                    return false;
                } else {
                    dayNum_param_temp = dayNum_param[k].value + "-" + timeNum_param[k].value;
                }
            }


            var lottoActivityAward = {};
            lottoActivityAward.dayNum_param = dayNum_param[k].value;
            lottoActivityAward.timeNum_param = timeNum_param[k].value;
            lottoActivityAward.startDay_1_param = startDay_1_param[k].value;
            lottoActivityAward.endDay_1_param = endDay_1_param[k].value;

            //获取该波奖品集合
            var lottoActivityAwardDetail = "";
            lottoActivityAwardDetail = dayNum_param[k].parentNode.parentNode.children;

//            console.log("lottoActivityAwardDetail" + k + ": " + lottoActivityAwardDetail.item(k).innerHTML);

            var awardNum = lottoActivityAwardDetail[k].getElementsByClassName('awardNum_param');
            var awardtype = lottoActivityAwardDetail[k].getElementsByClassName('awardtype_param');
            var productName = lottoActivityAwardDetail[k].getElementsByClassName('productName_param');
            var productUrl = lottoActivityAwardDetail[k].getElementsByClassName('productUrl_param');
            var productNum = lottoActivityAwardDetail[k].getElementsByClassName('productNum_param');

            var discountType = lottoActivityAwardDetail[k].getElementsByClassName('discountType_param');
            var discountNum = lottoActivityAwardDetail[k].getElementsByClassName('discountNum_param');

            var lottoActivityAwardDetailList = [];                 //奖品列表
            for (var m = 0; m < awardNum.length; m++) {
                var lottoActivityAwardDetail_list = {};
                lottoActivityAwardDetail_list.awardNum = awardNum[m].value;
                lottoActivityAwardDetail_list.awardtype = awardtype[m].value;
                if (productName[m] != null && productName[m] != "") {
                    lottoActivityAwardDetail_list.productName = productName[m].value;
                }
                if (productUrl[m] != null && productUrl[m] != "") {
                    lottoActivityAwardDetail_list.productUrl = productUrl[m].value;
                }
                if (productNum[m] != null && productNum[m] != "") {
                    lottoActivityAwardDetail_list.productNum = productNum[m].value;
                }
                if (discountType[m] != null && discountType[m] != "") {
                    lottoActivityAwardDetail_list.discountType = discountType[m].value;
                }
                if (discountNum[m] != null && discountNum[m] != "") {
                    lottoActivityAwardDetail_list.discountNum = discountNum[m].value;
                }
                lottoActivityAwardDetailList.push(lottoActivityAwardDetail_list);
            }
            lottoActivityAward.lottoActivityAwardDetailList = lottoActivityAwardDetailList;
            lottoActivityAwardList.push(lottoActivityAward);
        }


        data = {
            "lottoActivityName": lottoActivityName,
            "activityStartDay": activityStartDay,
            "activityEndDay": activityEndDay,
            "lottoActivityAwardList": lottoActivityAwardList
        };
        console.log("data:" + JSON.stringify(data));
        $.ajax({
            url: "/xcr/toc/saveRegistLottoActivity.htm",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(data),
            success: function (data) {
                if (data == 0) {
                    console.log("data:" + data);
                    $("#success").modal("toggle");
                    $('#success').on('hidden.bs.modal', function () {
                        $("#saveActivity").attr("disabled", false);
                        //跳转到列表
                        javascript:loadHtml('/xcr/toc/registLottoActivityList.htm');
                    })
                } else if (data == 2) {
                    $("#saveActivity").attr("disabled", false);
                    $("#fail").modal("toggle");
                } else if (data == 1) {
                    $("#saveActivity").attr("disabled", false);
                    $("#timeOverError").modal("toggle");
                } else if (data == 3) {
                    $("#saveActivity").attr("disabled", false);
                    $("#activityTimeOverError").modal("toggle");
                }
            },
            error: function (data) {
                $("#saveActivity").attr("disabled", false);
                $("#serverFail").modal("toggle");
            }
        });
    }
</script>
</body>
</html>